// src/components/forecast/ForecastingDashboard.tsx
import React, { useState } from 'react';
import CivilStatusForecastChart from "../components/charts/civilStatusCharts";
import { useCivilStatusForecast } from "../hooks/useCivilStatusForecast";

const civilStatusCategories = ["Single", "Married", "Widowed", "Divorced"];

const ForecastingDashboard: React.FC = () => {
  const [selectedCategory, setSelectedCategory] = useState("Single");

  const {
    forecastData,
    metrics,
    isTraining,
    trainModel,
    saveModel,
    loadModel,
    downloadModel,
    uploadModel,
    deleteModel,
  } = useCivilStatusForecast();

  const handleTrain = () => {
    trainModel(selectedCategory);
  };

  const handleUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {
    const files = event.target.files;
    if (!files || files.length === 0) return;
    await uploadModel(files);
  };

  return (
    <div className="w-full py-10 px-6 max-w-6xl mx-auto">
      <h2 className="text-2xl font-bold text-[#5c0a0a] mb-6">
        Civil Status Forecasting Dashboard
      </h2>

      {/* Category Selector */}
      <div className="flex flex-col sm:flex-row gap-4 items-center mb-6">
        <select
          className="border p-2 rounded-lg shadow-sm"
          value={selectedCategory}
          onChange={(e) => setSelectedCategory(e.target.value)}
        >
          {civilStatusCategories.map((cat) => (
            <option key={cat} value={cat}>{cat}</option>
          ))}
        </select>

        <button
          onClick={handleTrain}
          className="bg-[#8B1538] text-white px-4 py-2 rounded-lg shadow hover:bg-[#6f0f2b] transition"
          disabled={isTraining}
        >
          {isTraining ? "Training..." : "Run Forecast"}
        </button>
      </div>

      {/* Action Buttons */}
      <div className="flex flex-wrap gap-3 mb-8">
        <button onClick={saveModel} className="btn-action">Save Model</button>
        <button onClick={loadModel} className="btn-action">Load Model</button>
        <button onClick={downloadModel} className="btn-action">Download</button>

        {/* Upload model */}
        <label className="btn-action cursor-pointer">
          Upload
          <input
            type="file"
            accept=".json,.bin"
            className="hidden"
            multiple
            onChange={handleUpload}
          />
        </label>

        <button onClick={deleteModel} className="btn-danger">
          Delete Model
        </button>
      </div>

      {/* Metrics */}
      {metrics && (
        <div className="bg-white/70 backdrop-blur-md shadow-md rounded-xl p-4 mb-8 border">
          <h3 className="font-semibold mb-2 text-[#5c0a0a]">Model Metrics</h3>
          <div className="grid grid-cols-2 sm:grid-cols-4 gap-4 text-sm">
            <div><strong>Accuracy:</strong> {metrics.accuracy.toFixed(3)}</div>
            <div><strong>MAE:</strong> {metrics.mae.toFixed(3)}</div>
            <div><strong>RMSE:</strong> {metrics.rmse.toFixed(3)}</div>
            <div><strong>RÂ² Score:</strong> {metrics.r2.toFixed(3)}</div>
          </div>
        </div>
      )}

      {/* Chart */}
      {forecastData.length > 0 && (
        <CivilStatusForecastChart
          data={forecastData}
          category={selectedCategory}
        />
      )}
    </div>
  );
};

export default ForecastingDashboard;
